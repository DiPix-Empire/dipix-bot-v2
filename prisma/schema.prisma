generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  //id
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  //personal data
  nickname   String    @unique
  age        Int
  request    Request   @relation(fields: [requestId], references: [id])
  requestId  String    @unique
  //social links
  discord    String    @unique
  telegram   String?
  //in-game info
  profile    Profile[]
  country    Country?  @relation(fields: [countryId], references: [id])
  countryId  String?   @db.ObjectId
  //payments
  balance    Float     @default(0)
  donates    Donate[]
  lastUpdate DateTime // Last time when subscription updated
  nextUpdate DateTime // Next time when subscription should be updated
  plan       Plan      @default(default)
  promo      Promo?    @relation(fields: [promoId], references: [id])
  promoId    String?   @db.ObjectId
  invitedBy  String?
  invites    String[]
}

model Donate {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?  @db.ObjectId
  timestamp DateTime
  value     Float
}

enum Plan {
  default
  sponsor
}

model Promo {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  percentage Int
  whoAdded   String
  user       User[]
}

model Request {
  id      String  @id @default(auto()) @map("_id") @db.ObjectId
  message String
  fields  String
  discord String
  user    User[]
  locked  Boolean
}

model Autos {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  discord     String
  whoAccepted String
}

model Profile {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])
  number Int
  file   String
  userId String @db.ObjectId
}

model Country {
  id       String   @id @default(auto()) @map("_id") @db.ObjectId
  discord  String   @unique
  name     String   @unique
  citizens User[]
  ruler    String
  police   String[]
  mayor    String[]
  judge    String[]
}
